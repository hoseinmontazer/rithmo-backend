{
  "info": {
    "name": "Rithmo API - Authentication",
    "description": "Authentication endpoints for Rithmo Period Tracker API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "generated-20251217-173653",
    "version": "1.0.0"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{access_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://api.rithmo.ir",
      "type": "string",
      "description": "Base URL for the API"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string",
      "description": "JWT access token (auto-populated after login)"
    },
    {
      "key": "refresh_token",
      "value": "",
      "type": "string",
      "description": "JWT refresh token (auto-populated after login)"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string",
      "description": "Current user ID (set manually if needed)"
    },
    {
      "key": "partner_id",
      "value": "",
      "type": "string",
      "description": "Partner user ID (set manually for partner operations)"
    }
  ],
  "item": [
    {
      "name": "User Management (Djoser)",
      "item": [
        {
          "name": "Register User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/users/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                ""
              ]
            },
            "auth": {
              "type": "noauth"
            },
            "description": "Register a new user account with sex field",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"testuser\",\n  \"email\": \"test@example.com\",\n  \"password\": \"SecurePass123!\",\n  \"re_password\": \"SecurePass123!\",\n  \"sex\": \"female\"\n}"
            }
          }
        },
        {
          "name": "Activate User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/users/activation/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                "activation",
                ""
              ]
            },
            "auth": {
              "type": "noauth"
            },
            "description": "Activate user account using email token",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"uid\": \"user_id_from_email\",\n  \"token\": \"activation_token_from_email\"\n}"
            }
          }
        },
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/auth/users/me/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                "me",
                ""
              ]
            },
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "description": "Get current authenticated user details"
          }
        },
        {
          "name": "Update Current User",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/users/me/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                "me",
                ""
              ]
            },
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "description": "Update current user information",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"first_name\": \"John\",\n  \"last_name\": \"Doe\",\n  \"email\": \"newemail@example.com\"\n}"
            }
          }
        },
        {
          "name": "Change Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/users/set_password/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                "set_password",
                ""
              ]
            },
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "description": "Change user password",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"new_password\": \"NewSecurePass123!\",\n  \"re_new_password\": \"NewSecurePass123!\",\n  \"current_password\": \"SecurePass123!\"\n}"
            }
          }
        },
        {
          "name": "Reset Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/users/reset_password/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                "reset_password",
                ""
              ]
            },
            "auth": {
              "type": "noauth"
            },
            "description": "Request password reset email",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\"\n}"
            }
          }
        },
        {
          "name": "Confirm Password Reset",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/users/reset_password_confirm/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                "reset_password_confirm",
                ""
              ]
            },
            "auth": {
              "type": "noauth"
            },
            "description": "Confirm password reset with token",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"uid\": \"user_id_from_email\",\n  \"token\": \"reset_token_from_email\",\n  \"new_password\": \"NewSecurePass123!\",\n  \"re_new_password\": \"NewSecurePass123!\"\n}"
            }
          }
        },
        {
          "name": "Delete User Account",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/auth/users/me/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                "me",
                ""
              ]
            },
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "description": "Delete current user account",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"current_password\": \"SecurePass123!\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "JWT Authentication",
      "item": [
        {
          "name": "Login (Get JWT Token)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    ",
                  "    // Save to both collection and environment variables",
                  "    // This works for both development and production environments",
                  "    pm.collectionVariables.set('access_token', jsonData.access);",
                  "    pm.collectionVariables.set('refresh_token', jsonData.refresh);",
                  "    ",
                  "    // Also save to environment variables (for production)",
                  "    pm.environment.set('access_token', jsonData.access);",
                  "    pm.environment.set('refresh_token', jsonData.refresh);",
                  "    ",
                  "    // Save user info if available",
                  "    if (jsonData.user_id) {",
                  "        pm.collectionVariables.set('user_id', jsonData.user_id);",
                  "        pm.environment.set('user_id', jsonData.user_id);",
                  "    }",
                  "    ",
                  "    console.log('‚úÖ Tokens saved successfully to both collection and environment variables');",
                  "    console.log('üîë Access Token:', jsonData.access.substring(0, 30) + '...');",
                  "    console.log('üîÑ Refresh Token:', jsonData.refresh.substring(0, 30) + '...');",
                  "    console.log('üìç Environment:', pm.environment.name || 'No environment selected');",
                  "} else {",
                  "    console.log('‚ùå Login failed with status:', pm.response.code);",
                  "    console.log('üìù Response:', pm.response.text());",
                  "    ",
                  "    // Clear tokens on failed login",
                  "    pm.collectionVariables.unset('access_token');",
                  "    pm.collectionVariables.unset('refresh_token');",
                  "    pm.environment.unset('access_token');",
                  "    pm.environment.unset('refresh_token');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "auth": {
              "type": "noauth"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"Zara\",\n  \"password\": \"Aa12345678@\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/jwt/create/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "jwt",
                "create",
                ""
              ]
            },
            "description": "Login with username and password to get JWT tokens. Tokens are automatically saved to collection variables."
          }
        },
        {
          "name": "Refresh JWT Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    ",
                  "    // Update access token in both collection and environment",
                  "    pm.collectionVariables.set('access_token', jsonData.access);",
                  "    pm.environment.set('access_token', jsonData.access);",
                  "    ",
                  "    console.log('‚úÖ Access token refreshed successfully');",
                  "    console.log('üîë New Access Token:', jsonData.access.substring(0, 30) + '...');",
                  "    console.log('üìç Environment:', pm.environment.name || 'No environment selected');",
                  "} else {",
                  "    console.log('‚ùå Token refresh failed with status:', pm.response.code);",
                  "    console.log('üìù Response:', pm.response.text());",
                  "    console.log('üîÑ Please login again to get new tokens');",
                  "    ",
                  "    // Clear invalid tokens",
                  "    pm.collectionVariables.unset('access_token');",
                  "    pm.collectionVariables.unset('refresh_token');",
                  "    pm.environment.unset('access_token');",
                  "    pm.environment.unset('refresh_token');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "auth": {
              "type": "noauth"
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refresh\": \"{{refresh_token}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/jwt/refresh/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "jwt",
                "refresh",
                ""
              ]
            },
            "description": "Refresh access token using refresh token. New access token is automatically saved."
          }
        },
        {
          "name": "Verify JWT Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/jwt/verify/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "jwt",
                "verify",
                ""
              ]
            },
            "auth": {
              "type": "noauth"
            },
            "description": "Verify if JWT token is valid",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"{{access_token}}\"\n}"
            }
          }
        },
        {
          "name": "Test Authentication",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/auth/users/me/",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "users",
                "me",
                ""
              ]
            },
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "description": "Test if authentication is working by getting current user info"
          }
        }
      ]
    }
  ]
}